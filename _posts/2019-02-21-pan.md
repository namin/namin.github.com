---
layout: post
title: Pan in JavaScript
codemirror: javascript
---

<script>
  function debug(x) {
    console.log(x)
    return x;
  }
  function drawImage(f, canvas) {
    var w = 300;
    var h = 300;
    var ws = 10;
    var hs = 10;
    var gCanvas = document.getElementById(canvas);

    var gCtx = gCanvas.getContext("2d");
    gCtx.fillRect(0,0,w,h);

    var imageData = gCtx.getImageData(0,0,w,h);

    for (var x = 0; x < imageData.width; x++) {
      for (var y = 0; y < imageData.height; y++) {
        var offset = (y * imageData.width + x) * 4;

        var xs = ws*(x/w-0.5);
        var ys = hs*(y/h-0.5);

        var p = f({'x':xs, 'y':ys});

        var c = p*255;
        var a = 1.0*255;

        imageData.data[offset] = c;
        imageData.data[offset + 1] = c;
        imageData.data[offset + 2] = c;
        imageData.data[offset + 3] = a;
      }
    }
    gCtx.putImageData(imageData, 0, 0);
  }
  function drawAnimation(a, canvas) {
    function drawInTime() {
      var time = (new Date()).getMilliseconds() / 100;
      drawImage(a(time), canvas);
      window.requestAnimationFrame(drawInTime);
    }
    window.requestAnimationFrame(drawInTime);
  }
  var abs = Math.abs;
  var floor = Math.floor;
  var sqrt = Math.sqrt;
  var cos = Math.cos;
  var sin = Math.sin;
  var pi = Math.PI;
  function even(n) {
    return n % 2 == 0;
  }
  function square(x) {
    return x*x;
  }
  function distO(point) {
    return sqrt(square(point.x) + square(point.y));
  }
  function fromPolar(p) {
    return {'x':p.rho * cos(p.theta),
            'y':p.rho * sin(p.theta)};
  }
  function toPolar(point) {
    return {'rho':distO(point),
            'theta':Math.atan2(point.y, point.x)};
  }
  function vstrip(point) {
    return abs(point.x) <= 1/2;
  }
  function checker(point) {
    return even(floor(point.x) + floor(point.y));
  }
  function altRings(point) {
    return even(floor(distO(point)));
  }
  function makePolar(f, n) {
    function sc(p) {
      return {'x':p.rho,
              'y':p.theta*n/Math.PI};
    }
    return function(point) {
      return f(sc(toPolar(point)));
    }
  }
  var polarChecker = makePolar(checker, 10);
  var polarStrip = makePolar(vstrip, 10);
  function region(f) {
    return function(point) {
      return f(point) ? 0.0 : 1.0;
    };
  }
  function rotate(ang, point) {
    var c = cos(ang);
    var s = sin(ang);
    return {'x':point.x*c - point.y*s, 'y':point.y*c + point.x*s};
  }
  function swirling(r) {
    return function(point) {
      return rotate(distO(point) * (2*pi/r), point);
    }
  }
  function makeSwirl(f) {
    return function(t) {
      return region(function(point) {
        return f(swirling(t*t)(point));
      });
    }
  }
  var swirlt = makeSwirl(vstrip);
  var swirlChecker = makeSwirl(checker);
  var swirlPolarChecker = makeSwirl(polarChecker);
  function drawAll() {
    drawImage(region(vstrip), "canvas_vstrip");
    drawImage(region(checker), "canvas_checker");
    drawImage(region(altRings), "canvas_altRings");
    drawImage(region(polarChecker), "canvas_polarChecker");
    drawImage(region(polarStrip), "canvas_polarStrip");
    drawAnimation(swirlt, "canvas_swirlt");
    drawAnimation(swirlChecker, "canvas_swirlChecker");
    drawAnimation(swirlPolarChecker, "canvas_swirlPolarChecker");
  }
  window.onload = drawAll;
</script>


Recreates a bit of the
[Pan](http://conal.net/papers/functional-images/) library in
JavaScript. An image is a function from point to pixel (boolean for
black and white, color, etc.). An animation is a function from time to
image.

## vstrip

{% highlight javascript %}
    function vstrip(point) {
      return abs(point.x) <= 1/2;
    }
{% endhighlight %}

<center>
<canvas id="canvas_vstrip" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## checker

{% highlight javascript %}
    function checker(point) {
      return even(floor(point.x) + floor(point.y));
    }
{% endhighlight %}

<center>
<canvas id="canvas_checker" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## altRings

{% highlight javascript %}
  function distO(point) {
    return sqrt(square(point.x) + square(point.y));
  }
{% endhighlight %}
{% highlight javascript %}
    function altRings(point) {
      return even(floor(distO(point)));
    }
{% endhighlight %}

<center>
<canvas id="canvas_altRings" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## polarChecker

{% highlight javascript %}
  function fromPolar(p) {
    return {'x':p.rho * cos(p.theta),
            'y':p.rho * sin(p.theta)};
  }
  function toPolar(point) {
    return {'rho':distO(point),
            'theta':Math.atan2(point.y, point.x)};
  }
{% endhighlight %}
{% highlight javascript %}
    function makePolar(f, n) {
      function sc(p) {
        return {'x':p.rho,
                'y':p.theta*n/Math.PI};
      }
      return function(point) {
        return f(sc(toPolar(point)));
      }
    }
{% endhighlight %}
{% highlight javascript %}
    var polarChecker = makePolar(checker, 10);
{% endhighlight %}

<center>
<canvas id="canvas_polarChecker" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## polarStrip

{% highlight javascript %}
    var polarStrip = makePolar(vstrip, 10);
{% endhighlight %}

<center>
<canvas id="canvas_polarStrip" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## swirlt

{% highlight javascript %}
    function swirling(r) {
      return function(point) {
        return rotate(distO(point) * (2*pi/r), point);
      }
    }
    function makeSwirl(f) {
      return function(t) {
        return region(function(point) {
          return f(swirling(t*t)(point));
        });
      }
    }
{% endhighlight %}
{% highlight javascript %}
    var swirlt = makeSwirl(vstrip);
{% endhighlight %}

<center>
<canvas id="canvas_swirlt" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## swirlChecker

{% highlight javascript %}
    var swirlChecker = makeSwirl(checker);
{% endhighlight %}

<center>
<canvas id="canvas_swirlChecker" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>

## swirlPolarChecker

{% highlight javascript %}
    var swirlPolarChecker = makeSwirl(polarChecker);
{% endhighlight %}

<center>
<canvas id="canvas_swirlPolarChecker" width="300" height="300" style="border: 1px solid black;"></canvas>
</center>
